<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Android Video Playback made easy."><link href=https://eneim.github.io/kohii/usages/ rel=canonical><meta name=author content="2019 Nam Nguyen, nam@ene.im"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.5.0"><title>Kohii</title><link rel=stylesheet href=../assets/stylesheets/application.1b62728e.css><link rel=stylesheet href=../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../assets/javascripts/modernizr.268332fc.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../assets/fonts/material-icons.css><link rel=stylesheet href=../css/main.css></head> <body dir=ltr data-md-color-primary=black data-md-color-accent=black> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#common-usages-of-kohii tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://eneim.github.io/kohii title=Kohii class="md-header-nav__button md-logo"> <img src=../art/ic_launcher-web.png width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Kohii </span> <span class=md-header-nav__topic> Common usages of Kohii </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/eneim/kohii/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> Kohii </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://eneim.github.io/kohii title=Kohii class="md-nav__button md-logo"> <img src=../art/ic_launcher-web.png width=48 height=48> </a> Kohii </label> <div class=md-nav__source> <a href=https://github.com/eneim/kohii/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> Kohii </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. title=Overview class=md-nav__link> Overview </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> API </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> API </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../api/kohii-core/ title=kohii-core class=md-nav__link> kohii-core </a> </li> <li class=md-nav__item> <a href=../api/kohii-exoplayer/ title=kohii-exoplayer class=md-nav__link> kohii-exoplayer </a> </li> <li class=md-nav__item> <a href=../api/kohii-androidx/ title=kohii-androidx class=md-nav__link> kohii-androidx </a> </li> <li class=md-nav__item> <a href=../api/kohii-ads/ title=kohii-ads class=md-nav__link> kohii-ads </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#required-common-setup-for-kohii class=md-nav__link> Required: common setup for Kohii </a> </li> <li class=md-nav__item> <a href=#usages class=md-nav__link> Usages </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#10-one-video-to-one-existing-playerview class=md-nav__link> 1.0 One video to one existing PlayerView </a> </li> <li class=md-nav__item> <a href=#11-same-as-10-with-listeners class=md-nav__link> 1.1 Same as 1.0, with listeners </a> </li> <li class=md-nav__item> <a href=#20-setup-videos-in-nestedscrollviewscrollview class=md-nav__link> 2.0 Setup Videos in NestedScrollView/~~ScrollView~~ </a> </li> <li class=md-nav__item> <a href=#30-setup-videos-in-recyclerview class=md-nav__link> 3.0 Setup Videos in RecyclerView </a> </li> <li class=md-nav__item> <a href=#40-setup-videos-in-viewpager-whose-pages-are-fragments class=md-nav__link> 4.0 Setup Videos in ViewPager whose pages are Fragments </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/eneim/kohii/edit/master/docs/usages/README.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1 id=common-usages-of-kohii>Common usages of Kohii<a class=headerlink href=#common-usages-of-kohii title="Permanent link">&para;</a></h1> <h2 id=required-common-setup-for-kohii>Required: common setup for Kohii<a class=headerlink href=#required-common-setup-for-kohii title="Permanent link">&para;</a></h2> <p>Assuming that you are using <strong>Kohii</strong> in a Fragment <code>MyFragment</code>, having a ViewGroup to contains some Videos. Below steps are to initialize <strong>Kohii</strong> before going any further.</p> <p>■ Initialize <strong>Kohii</strong> instance. It will be global and unique in your application lifecycle.</p> <div class=codehilite><pre><span></span><span class=k>val</span> <span class=py>kohii</span> <span class=p>=</span> <span class=n>Kohii</span><span class=p>[</span><span class=k>this</span><span class=n>@MyFragment</span><span class=p>]</span>
</pre></div> <p>■ Register current Fragment as the <code>PlaybackManager</code>. In <strong>Kohii</strong>, <code>PlaybackManager</code> helps manage all Videos in a Fragment or Activity. When using with <code>ViewPager</code> whose pages are <code>Fragment</code>s, we need to register both the parent <code>Fragment</code> (who owns the <code>ViewPager</code>) and child <code>Fragment</code> (who is page of the <code>ViewPager</code>). </p> <div class=codehilite><pre><span></span><span class=c1>// Calling this will return a ``PlaybackManager`` instance</span>
<span class=k>val</span> <span class=py>manager</span> <span class=p>=</span> <span class=n>kohii</span><span class=p>.</span><span class=n>register</span><span class=p>(</span><span class=k>this</span><span class=n>@MyFragment</span><span class=p>)</span>
</pre></div> <p>■ Register the ViewGroup that contains the Videos inside. It may or may not be the direct parent of the Video View. In <strong>Kohii</strong>, a <code>View</code> that is used to render a Video playback is called <code>Target</code> and the <code>ViewGroup</code> which is the parent of a <code>Target</code> is called <em>host</em>. To help the ViewGroup <em>watch</em> its Targets, <strong>Kohii</strong> has the <code>TargetHost</code> to wrap this ViewGroup. Here is how we create a <code>TargetHost</code> by registering the <code>ViewGroup</code>:</p> <div class=codehilite><pre><span></span><span class=c1>// This returns a nullable TargetHost instance</span>
<span class=c1>// The result is null when the View is already registered before, not null otherwise.</span>
<span class=k>val</span> <span class=py>host</span> <span class=p>=</span> <span class=n>manager</span><span class=p>.</span><span class=n>registerTargetHost</span><span class=p>(</span><span class=n>videoHostViewGroup</span><span class=p>)</span>
</pre></div> <p>That is enough for a common usage. In practice, your setup will look like below:</p> <div class=codehilite><pre><span></span><span class=c1>// Setup **Kohii** from Fragment&#39;s onViewCreated or Activity&#39;s onCreate method.</span>
<span class=k>override</span> <span class=k>fun</span> <span class=nf>onViewCreated</span><span class=p>(</span>
  <span class=n>view</span><span class=p>:</span> <span class=n>View</span><span class=p>,</span>
  <span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>?</span>
<span class=p>)</span> <span class=p>{</span>
  <span class=k>super</span><span class=p>.</span><span class=n>onViewCreated</span><span class=p>(</span><span class=n>view</span><span class=p>,</span> <span class=n>savedInstanceState</span><span class=p>)</span>
  <span class=k>val</span> <span class=py>kohii</span> <span class=p>=</span> <span class=n>Kohii</span><span class=p>[</span><span class=k>this</span><span class=n>@MyFragment</span><span class=p>]</span>
  <span class=k>val</span> <span class=py>manager</span> <span class=p>=</span> <span class=n>kohii</span><span class=p>.</span><span class=n>register</span><span class=p>(</span><span class=k>this</span><span class=n>@MyFragment</span><span class=p>)</span>
  <span class=k>val</span> <span class=py>host</span> <span class=p>=</span> <span class=n>manager</span><span class=p>.</span><span class=n>registerTargetHost</span><span class=p>(</span><span class=n>videoHostViewGroup</span><span class=p>)</span><span class=o>!!</span>

  <span class=c1>// TODO anything else</span>
<span class=p>}</span>
</pre></div> <p>In basic usage, you do not need to get returned value of the setting above:</p> <div class=codehilite><pre><span></span><span class=c1>// Setup **Kohii** from Fragment&#39;s onViewCreated or Activity&#39;s onCreate method.</span>
<span class=k>override</span> <span class=k>fun</span> <span class=nf>onViewCreated</span><span class=p>(</span>
  <span class=n>view</span><span class=p>:</span> <span class=n>View</span><span class=p>,</span>
  <span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>?</span>
<span class=p>)</span> <span class=p>{</span>
  <span class=k>super</span><span class=p>.</span><span class=n>onViewCreated</span><span class=p>(</span><span class=n>view</span><span class=p>,</span> <span class=n>savedInstanceState</span><span class=p>)</span>
  <span class=n>Kohii</span><span class=p>[</span><span class=k>this</span><span class=n>@MyFragment</span><span class=p>].</span><span class=n>also</span> <span class=p>{</span> <span class=n>kohii</span> <span class=p>-&gt;</span>
    <span class=n>kohii</span><span class=p>.</span><span class=n>register</span><span class=p>(</span><span class=k>this</span><span class=n>@MyFragment</span><span class=p>,</span> <span class=n>videoHostViewGroup</span><span class=p>)</span> <span class=c1>// an overloaded version of register().</span>
  <span class=p>}</span>

  <span class=c1>// TODO anything else</span>
<span class=p>}</span>
</pre></div> <h2 id=usages>Usages<a class=headerlink href=#usages title="Permanent link">&para;</a></h2> <h4 id=10-one-video-to-one-existing-playerview>1.0 One video to one existing PlayerView<a class=headerlink href=#10-one-video-to-one-existing-playerview title="Permanent link">&para;</a></h4> <blockquote> <p>In <strong>Kohii</strong>, the term <em>binding</em> stands for the act in that a Video resource provided by client being converted to playable resource (eg: a Uri to a MediaSource object), and then being prepared to the Surface to play the Video). It is just as simple concept as <code>videoView.setVideoPath(videoUri)</code>, but more powerful behavior.</p> </blockquote> <p>This is the most common/simple usage of <strong>Kohii</strong>. Assuming that you have an uri, and a <code>PlayerView</code> to show the Video named <code>playerView</code>, below is how to do it:</p> <div class=codehilite><pre><span></span><span class=n>kohii</span><span class=p>.</span><span class=n>setUp</span><span class=p>(</span><span class=n>uri</span><span class=p>).</span><span class=n>bind</span><span class=p>(</span><span class=n>playerView</span><span class=p>)</span>
</pre></div> <p>Note that, the <a href=#required-common-setup-for-kohii><strong>required</strong></a> steps above must be done first. Or else there will be no <code>TargetHost</code> to watch the <code>PlayerView</code>, and your client will throw exception.</p> <p>With that <em>one line</em>, you will have the following done:</p> <ul> <li> <p>The Uri you provided will be wrapped in a <code>MediaItem</code> object, and then be used to create a <code>Playable</code> object. This object has a <code>Bridge</code> object inside it contains all necessary resources for a Video playback: factory to build <code>MediaSource</code> from the <code>Uri</code>, pool to acquire <code>Player</code> instance for the playback, all preparation logic are done automatically and will wait for the trigger to start or pause the Video.</p> </li> <li> <p>A <code>Playback</code> object is created using the <code>Playable</code> above, and is added to the <code>PlaybackManager</code> we created before. This <code>PlaybackManager</code> will find the correct <code>TargetHost</code> for the <code>PlayerView</code>, listen to its behavior (scrolled, attached, detached, etc) to trigger the playback start/pause.</p> </li> </ul> <p>From this point onward, you have the Video to be automatically played/paused once user scrolls the list such that the <code>PlayerView</code> is visible more (will play) or less (will pause) than 65% of its area.</p> <p>Also, to ensure the playback is automatic, <strong>Kohii</strong> will forcefully disable the <code>PlayerView</code>'s <code>PlayerControlView</code> even if you set it before. To have manual playback control enabled, you need some additional configuration which will be discussed in next usage.</p> <h4 id=11-same-as-10-with-listeners>1.1 Same as 1.0, with listeners<a class=headerlink href=#11-same-as-10-with-listeners title="Permanent link">&para;</a></h4> <p>In practice, client wants to observe the status of the Playback. <strong>Kohii</strong> provides a listener system to fulfill this requirement.</p> <p>A <code>Playback</code> has the following important listeners you can use:</p> <details> <summary>Playback.Callback: listen to status of a Playback object:</summary> <div class=codehilite><pre><span></span><span class=k>interface</span> <span class=nc>Callback</span> <span class=p>{</span>

  <span class=cm>/** Called when the Playback is added to the PlaybackManager */</span>
  <span class=k>fun</span> <span class=nf>onAdded</span><span class=p>(</span><span class=n>playback</span><span class=p>:</span> <span class=n>Playback</span><span class=p>&lt;*&gt;)</span> <span class=p>{}</span>

  <span class=cm>/** Called when the Playback becomes active. It is equal to that the target PlayerView is attached to the Window */</span>
  <span class=k>fun</span> <span class=nf>onActive</span><span class=p>(</span><span class=n>playback</span><span class=p>:</span> <span class=n>Playback</span><span class=p>&lt;*&gt;)</span> <span class=p>{}</span>

  <span class=cm>/** Called when the Playback becomes inactive. It is equal to that the target PlayerView is detached from the Window */</span>
  <span class=k>fun</span> <span class=nf>onInActive</span><span class=p>(</span><span class=n>playback</span><span class=p>:</span> <span class=n>Playback</span><span class=p>&lt;*&gt;)</span> <span class=p>{}</span>

  <span class=cm>/** Called when the Playback is removed from the PlaybackManager */</span>
  <span class=k>fun</span> <span class=nf>onRemoved</span><span class=p>(</span><span class=n>playback</span><span class=p>:</span> <span class=n>Playback</span><span class=p>&lt;*&gt;)</span> <span class=p>{}</span>
<span class=p>}</span>
</pre></div> </details> <details> <summary>PlaybackEventListener: listen to play/pause/end event of a playback:</summary> <div class=codehilite><pre><span></span><span class=k>interface</span> <span class=nc>PlaybackEventListener</span> <span class=p>{</span>

  <span class=cm>/** Called when a Video is rendered on the Surface for the first time */</span>
  <span class=k>fun</span> <span class=nf>onFirstFrameRendered</span><span class=p>(</span><span class=n>playback</span><span class=p>:</span> <span class=n>Playback</span><span class=p>&lt;*&gt;)</span> <span class=p>{}</span>

  <span class=cm>/**</span>
<span class=cm>   * Called when buffering status of the playback is changed.</span>
<span class=cm>   *</span>
<span class=cm>   * @param playWhenReady true if the Video will start playing once buffered enough, false otherwise.</span>
<span class=cm>   */</span>
  <span class=k>fun</span> <span class=nf>onBuffering</span><span class=p>(</span>
    <span class=n>playback</span><span class=p>:</span> <span class=n>Playback</span><span class=p>&lt;*&gt;,</span>
    <span class=n>playWhenReady</span><span class=p>:</span> <span class=n>Boolean</span>
  <span class=p>)</span> <span class=p>{</span>
  <span class=p>}</span> <span class=c1>// ExoPlayer state: 2</span>

  <span class=cm>/** Called when the Video starts playing */</span>
  <span class=k>fun</span> <span class=nf>onPlay</span><span class=p>(</span><span class=n>playback</span><span class=p>:</span> <span class=n>Playback</span><span class=p>&lt;*&gt;)</span> <span class=p>{}</span> <span class=c1>// ExoPlayer state: 3, play flag: true</span>

  <span class=cm>/** Called when the Video is paused */</span>
  <span class=k>fun</span> <span class=nf>onPause</span><span class=p>(</span><span class=n>playback</span><span class=p>:</span> <span class=n>Playback</span><span class=p>&lt;*&gt;)</span> <span class=p>{}</span> <span class=c1>// ExoPlayer state: 3, play flag: false</span>

  <span class=cm>/** Called when the Video finishes its playback */</span>
  <span class=k>fun</span> <span class=nf>onEnd</span><span class=p>(</span><span class=n>playback</span><span class=p>:</span> <span class=n>Playback</span><span class=p>&lt;*&gt;)</span> <span class=p>{}</span> <span class=c1>// ExoPlayer state: 4</span>

  <span class=cm>/** Called when right before Playback&#39;s play() method is called. Maybe called multiple times */</span>
  <span class=k>fun</span> <span class=nf>beforePlay</span><span class=p>(</span><span class=n>playback</span><span class=p>:</span> <span class=n>Playback</span><span class=p>&lt;*&gt;)</span> <span class=p>{}</span>

  <span class=cm>/** Called when right after Playback&#39;s pause() method is called. Maybe called multiple times */</span>
  <span class=k>fun</span> <span class=nf>afterPause</span><span class=p>(</span><span class=n>playback</span><span class=p>:</span> <span class=n>Playback</span><span class=p>&lt;*&gt;)</span> <span class=p>{}</span>
<span class=p>}</span>
</pre></div> </details> <p>Before going into the actual setup, let's take a look at what we have done and what we got.</p> <p>First, the <code>bind</code> method above has the full signature as below:</p> <div class=codehilite><pre><span></span><span class=k>fun</span> <span class=p>&lt;</span><span class=n>CONTAINER</span> <span class=p>:</span> <span class=n>Any</span><span class=p>&gt;</span> <span class=nf>bind</span><span class=p>(</span>
  <span class=n>target</span><span class=p>:</span> <span class=n>CONTAINER</span><span class=p>,</span>
  <span class=n>callback</span><span class=p>:</span> <span class=p>((</span><span class=n>Playback</span><span class=p>&lt;</span><span class=n>OUTPUT</span><span class=p>&gt;)</span> <span class=p>-&gt;</span> <span class=n>Unit</span><span class=p>)?</span> <span class=p>=</span> <span class=k>null</span>
<span class=p>)</span>
</pre></div> <p>Here you can see a callback that is null by default. This callback send back to client the <code>Playback</code> instance that was created by the setup. Using this <code>Playback</code>, client can have further setup, like adding listeners.</p> <p>Second, calling <code>kohii.setUp(uri)</code> will return an important object: a <code>Binder</code>.</p> <p><code>Binder</code> object is the builder of a Playable and can be used to <em>bind</em> a Playable to a Target. Being a builder, it allows client to give more configuration via <code>Binder.with(Params)</code> method. You can call it in <em>Kotlin DSL</em> style like below:</p> <div class=codehilite><pre><span></span><span class=n>kohii</span><span class=p>.</span><span class=n>setUp</span><span class=p>(</span><span class=n>uri</span><span class=p>).</span><span class=n>with</span> <span class=p>{</span>
  <span class=n>tag</span> <span class=p>=</span> <span class=n>uniqueTag</span>
  <span class=n>repeatMode</span> <span class=p>=</span> <span class=n>REPEAT_MODE_ONE</span>
<span class=p>}</span> <span class=c1>// this method returns the Binder object</span>
</pre></div> <p>The <code>bind</code> method above is an instance method of <code>Binder</code> object. <code>Binder</code> allows <code>Playback.Callback</code> as a parameter. This is because this callback send the signal of a <code>Playback</code> being added to the manager. This event happens before the callback in <code>bind</code> method returns. Therefore, to be able to listen to the <code>onAdded</code> callback, <code>Playback.Callback</code> need to be added earlier.</p> <p>On the other hand, the <code>PlaybackEventListener</code> can be added at any time. Let's take a look at the setup below:</p> <div class=codehilite><pre><span></span><span class=n>kohii</span><span class=p>.</span><span class=n>setUp</span><span class=p>(</span><span class=n>uri</span><span class=p>)</span>  <span class=c1>// this return a Binder</span>
  <span class=p>.</span><span class=n>with</span> <span class=p>{</span>
    <span class=n>callback</span> <span class=p>=</span> <span class=n>myCallback</span>
  <span class=p>}</span> <span class=c1>// the same Binder, now with callback installed</span>
  <span class=p>.</span><span class=n>bind</span><span class=p>(</span><span class=n>playerView</span><span class=p>)</span> <span class=p>{</span> <span class=n>playback</span> <span class=p>-&gt;</span>
    <span class=n>playback</span><span class=p>.</span><span class=n>addPlaybackEventListener</span><span class=p>(</span><span class=n>playbackListener</span><span class=p>)</span>
  <span class=p>}</span>
</pre></div> <p>With this setup, your <code>myCallback</code> will receive <code>onAdded</code> callback as expected. Also, it's worth notice that adding <code>PlaybackEventListener</code> will allow the client to receive the signal immediately. It means that, if the Video is playing, and client call <code>playback.addPlaybackEventListener(playbackListener)</code>, its <code>onPlay()</code> method will be called immediately.</p> <p>This allow client to response to the Playback state as soon as possible. For example showing or hidding thumbnail on relevent situations.</p> <h4 id=20-setup-videos-in-nestedscrollviewscrollview>2.0 Setup Videos in NestedScrollView/~~ScrollView~~<a class=headerlink href=#20-setup-videos-in-nestedscrollviewscrollview title="Permanent link">&para;</a></h4> <p><strong>Kohii</strong> support every possible <code>ViewGroup</code>, including <code>NestScrollView</code> or <code>ScrollView</code>. It's worth mention that <code>NestedScrollView</code> is superior to <code>ScrollView</code>, and is updated more frequently, so I recommend to use <code>NestedScrollView</code> instead. Below setup assumes the host is <code>NestedScrollView</code>.</p> <p>The same steps as <a href=#required-common-setup-for-kohii>before</a> are required.</p> <p>As <code>NestedScrollView</code> do not recycle its child like <code>RecyclerView</code>, for each PlayerView we just need to repeat the setup for one Video:</p> <div class=codehilite><pre><span></span><span class=c1>// videosToViews is of type Collection&lt;Pair&lt;Uri, PlayerView&gt;&gt;</span>
<span class=n>videosToViews</span><span class=p>.</span><span class=n>forEach</span> <span class=p>{</span> <span class=p>(</span><span class=n>uri</span><span class=p>,</span> <span class=n>playerView</span><span class=p>)</span> <span class=p>-&gt;</span> 
  <span class=n>kohii</span><span class=p>.</span><span class=n>setUp</span><span class=p>(</span><span class=n>uri</span><span class=p>).</span><span class=n>bind</span><span class=p>(</span><span class=n>playerView</span><span class=p>)</span>
<span class=p>}</span>
</pre></div> <p>(I use collection of Pairs just for demo purpose. It should be designed carefully in practice).</p> <p>With this setup, you will have what is done for one Video in one PlayerView, plus:</p> <ul> <li>PlayerView will only prepare the resource (setup Player instance, prepare MediaSource, etc) when it is partly or fully visible to user.</li> <li>When a PlayerView is scrolled off screen, Kohii will automatically release its resource.</li> </ul> <p>This means that, <strong>even if you setup for 100 Uris to 100 PlayerViews, only those are visible will be active and consume resource (networking, Video decoding, etc)</strong>.</p> <h4 id=30-setup-videos-in-recyclerview>3.0 Setup Videos in RecyclerView<a class=headerlink href=#30-setup-videos-in-recyclerview title="Permanent link">&para;</a></h4> <p>Setting up Videos in <code>RecyclerView</code> is pretty much the same with <code>NestedScrollView</code>: just setup the uri whenever you have one for a PlayerView. But because <code>RecyclerView</code> automatically recycle its Views, you don't need to worry about anything.</p> <h4 id=40-setup-videos-in-viewpager-whose-pages-are-fragments>4.0 Setup Videos in ViewPager whose pages are Fragments<a class=headerlink href=#40-setup-videos-in-viewpager-whose-pages-are-fragments title="Permanent link">&para;</a></h4> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019 Nam Nguyen, nam@ene.im </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../assets/fonts/font-awesome.css> <a href=https://github.com/eneim/kohii class="md-footer-social__link fa fa-github"></a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/application.a8b5e56f.js></script> <script>app.initialize({version:"1.0.4",url:{base:".."}})</script> </body> </html>